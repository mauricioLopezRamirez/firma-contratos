<!doctype html>
<html lang="en">

<head>
  <!-- required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="fonts/icomoon/style.css">

  <link rel="stylesheet" href="css/owl.carousel.min.css">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">

  <!-- Style -->
  <link rel="stylesheet" href="css/style.css">

  <title>Sign Up #7</title>
</head>

<body>



  <div class="content">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <img src="images/8493-ai.svg" alt="Image" class="img-fluid">
        </div>
        <div class="col-md-6 contents">
          <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="mb-4">
                <h3>Servicio de transporte escolar</h3>
                <p class="mb-4">Formulario de registro para diligenciar el contrato de mandato para transporte escolar
                  servicio puerta a puerta.</p>
              </div>
              <form>
                <div class="form-group first">
                  <label for="tipo_responsable">Registrarse como</label>
                  <select class="form-control" name="tipo_responsable" id="tipo_responsable" required>
                    <option></option>
                    <option>Padre de familia</option>
                    <option>Acudiente</option>
                  </select>
                </div>
                <div class="form-group first">
                  <label for="nombre_responsable">Nombres</label>
                  <input type="text" class="form-control" id="nombre_responsable" name="nombre_responsable" required>
                </div>
                <div class="form-group first">
                  <label for="apellidos_responsable">Apellidos</label>
                  <input type="text" class="form-control" id="apellidos_responsable" name="apellidos_responsable"
                    required>
                </div>

                <div class="form-group">
                  <label for="cedula_responsable">Número de cédula</label>
                  <input type="number" class="form-control" id="cedula_responsable" name="cedula_responsable" required>
                </div>
                <div class="form-group">
                  <label for="direccion_responsable">Dirección</label>
                  <input type="text" class="form-control" id="direccion_responsable" name="direccion_responsable"
                    required>
                </div>
                <div class="form-group">
                  <label for="telefono_responsable">Telefono</label>
                  <input type="number" class="form-control" id="telefono_responsable" name="telefono_responsable"
                    required>
                </div>


                <div class="form-group first">
                  <label for="modalidad_servicio">Modalidad de servicio</label>
                  <select class="form-control" name="modalidad_servicio" id="modalidad_servicio" required>
                    <option></option>
                    <option>Completo</option>
                    <option>Medio</option>
                    <option>Compartido</option>
                  </select>
                </div>

                <h3 style="margin:10px 0 10px 0">Datos del estudiante:</h3>

                <div class="form-group">
                  <label for="primer_nombre_estudiante">Primer Nombre</label>
                  <input type="text" class="form-control" id="primer_nombre_estudiante" name="primer_nombre_estudiante"
                    required>
                </div>
                <div class="form-group">
                  <label for="segundo_nombre_estudiante">Segundo Nombre</label>
                  <input type="text" class="form-control" id="segundo_nombre_estudiante"
                    name="segundo_nombre_estudiante">
                </div>
                <div class="form-group">
                  <label for="primer_apellido_estudiante">Primer Apellido</label>
                  <input type="text" class="form-control" id="primer_apellido_estudiante"
                    name="primer_apellido_estudiante" required>
                </div>
                <div class="form-group">
                  <label for="segundo_apellido_estudiante">Segundo Apellido</label>
                  <input type="text" class="form-control" id="segundo_apellido_estudiante"
                    name="segundo_apellido_estudiante">
                </div>

                <div class="form-group first">
                  <label for="grado_estudiante">Grado</label>
                  <select class="form-control" id="grado_estudiante" name="grado_estudiante" required>
                    <option></option>
                    <option>Primero</option>
                    <option>Segundo</option>
                    <option>Tercero</option>
                    <option>Cuerto</option>
                    <option>Quinto</option>
                    <option>Sexto</option>
                    <option>Septimo</option>
                    <option>Octavo</option>
                    <option>Noveno</option>
                    <option>Decimo</option>
                    <option>Once</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="codigo_estudiante">Código del estudiante</label>
                  <input type="number" class="form-control" id="codigo_estudiante" name="codigo_estudiante" required>
                </div>


                <h3 style="margin:10px 0 10px 0">Datos para recoger el alumno:</h3>

                <div class="form-group">
                  <label for="direccion_recogida">Direccion de recogida</label>
                  <input type="text" class="form-control" id="direccion_recogida" name="direccion_recogida" required>
                </div>
                <div class="form-group">
                  <label for="barrio_recogida">Barrio</label>
                  <input type="text" class="form-control" id="barrio_recogida" name="barrio_recogida" required>
                </div>

                <div class="form-group first">
                  <label for="tipo_residencia">Tipo de residencia</label>
                  <select class="form-control" id="tipo_residencia" name="tipo_residencia" required>
                    <option></option>
                    <option>Apartamento</option>
                    <option>Casa</option>
                    <option>Conjunto</option>
                  </select>
                </div>


                <h3 style="margin:10px 0 10px 0">Datos para dejar el alumno:</h3>

                <div class="form-group">
                  <label for="direccion_dejada">Dirección</label>
                  <input type="text" class="form-control" id="direccion_dejada" name="direccion_dejada" required>
                </div>
                <div class="form-group">
                  <label for="barrio_dejada">Barrio</label>
                  <input type="text" class="form-control" id="barrio_dejada" name="barrio_dejada" required>
                </div>

                <div class="form-group first">
                  <label for="tipo_residencia_dejada">Tipo de residencia</label>
                  <select class="form-control" id="tipo_residencia_dejada" name="tipo_residencia_dejada" required>
                    <option></option>
                    <option>Apartamento</option>
                    <option>Casa</option>
                    <option>Conjunto</option>
                  </select>
                </div>


                <h3 style="margin:10px 0 10px 0">Visualizar Contrato:</h3>
                <button type="button" class="btn btn-success btn-lg btn-block" data-toggle="modal"
                  data-target="#verContrato">Visualizar contrato</button>


                <h3 style="margin:10px 0 10px 0">Firma Manuscrita digital:</h3>
                <canvas></canvas>

                <div class="options">
                  <button type="button" class="btn btn-outline-warning btn-sm" onclick="clearSign()">Limpiar
                    Firma</button>
                  <button type="button" class="btn btn-outline-info btn-sm" data-toggle="modal"
                    data-target="#exampleModal">
                    Como firmar ?
                  </button>
                </div>


                <br>
                <div class="d-flex mb-5 align-items-center">
                  <label class="control control--checkbox mb-0"><span class="caption">Acepto los terminos y condiciones
                      del servicio
                      Terminos y condiciones, Politica de privacidad.</span>
                    <input type="checkbox" name="terminos" required>
                    <div class="control__indicator"></div>
                  </label>
                </div>

                <input type="submit" value="Guardar información y firmar" class="btn btn-block btn-primary">

              </form>


              <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">Realizar firma</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      Para realizar la firma puede rotar el celular y dibujar con los dedos en el recuadro verde.
                      <img style="width: 100%;" src="./images/signature.gif">
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    </div>
                  </div>
                </div>
              </div>



              <div class="modal fade" id="verContrato" tabindex="-1" role="dialog" aria-labelledby="verContrato"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="verContrato">Realizar firma</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <iframe style="border: none;" src="./images/contrato.pdf" width="100%"> </iframe>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    </div>
                  </div>
                </div>
              </div>


            </div>
          </div>

        </div>

      </div>
    </div>
  </div>


  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>

    const canvas = document.querySelector("canvas");
    const signaturePad = new SignaturePad(canvas, {
      minWidth: 0.1,
      maxWidth: 1,
    });

    function resizeCanvas() {
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      canvas.width = canvas.offsetWidth * ratio;
      canvas.height = (canvas.offsetHeight + 500);
      canvas.getContext("2d").scale(ratio, ratio);
      signaturePad.clear(); // otherwise isEmpty() might return incorrect value
    }
    //window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    clearSign = () => {
      signaturePad.clear();
    }
    async function handleSubmit(event) {
      event.preventDefault();
      if (!signaturePad.isEmpty()) {
        Swal.fire({
          title: 'Almacenando información',
          html: 'Por favor espere.',// add html attribute if you want or remove
          allowOutsideClick: false,
        });
        Swal.showLoading()
        const data = new FormData(event.target);
        const img_firma = signaturePad.toDataURL();
        data.append('sign', img_firma);
        const value = Object.fromEntries(data.entries());
        const response = await fetch("http://34.125.20.149:3334/api/generate", {
          method: 'POST',
          body: data
        });

        response.json().then(data => {
          swal.close();
          if (data.status) {
            Swal.fire(
              'Proceso finalizado satisfactoriamente',
            ).then(() => {
              location.reload()
            });
          }
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: 'Para continuar debes realizar la firma manuscrita en el recuadro verde ',
          footer: '<img style="width: 100px;" src="./images/signature.gif">'
        })

      }
    }
    const form = document.querySelector('form');
    form.addEventListener('submit', handleSubmit);


  </script>
</body>

</html>